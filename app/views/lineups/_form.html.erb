<%= form_with model: @lineup, local: true, class: "space-y-6" do |f| %>
  <div>
    <%= f.label :name, "※打順名", class: "block font-medium mb-1" %>
    <%= f.text_field :name, class: "w-full border rounded p-2" %>
  </div>

  <div>
    <%= f.label :description, "説明", class: "block font-medium mb-1" %>
    <%= f.text_area :description, class: "w-full border rounded p-2 h-24" %>
  </div>

  <% if @players.empty? %>
    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">
      <p class="font-medium">選手が登録されていません</p>
      <p class="text-sm mt-1">打順を作成するには、まず選手を登録してください。</p>
      <div class="mt-3">
        <%= link_to "選手を登録する", new_player_path, class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" %>
      </div>
    </div>
  <% else %>
    <div class="grid grid-cols-2 gap-4">
      <%= f.fields_for :lineup_entries do |entry_fields| %>
        <div>
          <%= entry_fields.label :player_id, "※#{entry_fields.object.batting_order}番", class: "block font-medium mb-1" %>
          <%= entry_fields.collection_select :player_id,
                @players, :id, :name,
                { prompt: "選手を選択" },
                { class: "w-full border rounded p-2", required: true } %>
          <%= entry_fields.hidden_field :batting_order %>

          <% if entry_fields.object.errors[:player_id].any? %>
            <p class="text-red-500 text-sm mt-1"><%= entry_fields.object.errors[:player_id].first %></p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="mt-6 flex items-center justify-between">
    <div>
      <%= f.submit @lineup.persisted? ? "更新" : "登録", 
            class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 #{'opacity-50 cursor-not-allowed' if @players.empty?}", 
            disabled: @players.empty? %>
      <%= link_to "戻る", lineups_path, class: "border px-4 py-2 rounded hover:bg-gray-100 ml-4" %>
    </div>
    
    <% unless @players.empty? %>
      <div>
        <%= link_to "選手を追加", new_player_path, class: "text-blue-600 hover:text-blue-800 text-sm" %>
      </div>
    <% end %>
  </div>
<% end %>